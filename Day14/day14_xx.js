let input = `O#....#.........#.##...O...#.O#..#...O..O#.##.OOO.O...#..#...#OO...OOO#O##..O.O.O..#....O..#...#....
...O...O...#OO......#.........O.##....O.#O#..OO.#.O##.O.#.#.O...#O.OOOO.O#..O.#OO....O.....O.O...O..
.....#..O....O....O....O..#OO.O..#O.......O......O.O.....OO....OO......##.O.#.#....#..#.#..OOO.#.O#.
.....#..##OO..O.....#..#...O..#..O..#O..#OOO..#......O...##......OO#....#......#O.....O#.#O#O...#...
#..O..OO##O...O#O#.OOO...#.....#.#O.O#....#..........O...O#O..........#........O.O.O#O...#..OO#.....
#O.#.....##.#.OO.#..#.OO#..#.##...#..O.O..........#O.#..OO.#..O.......O.#O..O..O.O..O.....O..OOO...#
#......O.##.##...OO..O.##.##.O.#..........#..O.###O...O...##.#....###OO...#...#............O.O..#.#O
....O...O.###.#.#...O..O..O.OO...O...#........#O.....O...O#.O.O.....O#O........##.O..#OO.OO#.O##....
.....O..O#..OO.....#.O..O.#.#............#.###...#.O.###......#O#.OO.#O..OO...O.....O#O......O......
.....O.O...O#.......O.......#.OO.O##..#...O.#....#..O.....O...O.O..O.O.#.O#O...#.#..O...#O..O..OO...
O..#..O......O.....O....##OO.O..O.....#.O.#..#.#O.#.#O..............##..#..O......O...O.##..O....#..
.#...#......#..O...###....#.O#...#..O..#O......##O.OO.O.......O#OO...O#.O.#....O.O#..#.#OO.O#O.OO...
...#...O#..#..##...OO####O#.#.##....###OO#.O..........O....#O...#.....OO#.#....O....O#.##...O.#.#...
...O.OO.OO#O#.##O..O.....O...#....#O.....#.#...#O#..#..OO.O.#.#O.#.O.#..OO....O..#..#.O.#O......OO..
......#...O#...O#...O...O#..........O.....#OOO#.......#.O.O...O...#.#...#O##..O##.OO..O.......O#O...
......#...O.O...O.O.....#....#.#.....#.#...#.O#....#OO.#...OO.....#.......O.#.....O......O..##......
#O.O.O.O.OO...O###.........O.#.....O#.......O#...#O......O..#.O...O.....O...#.##O.#..##O..O#...O.#.O
O.O...#...OO#.#....OO.O...###..OO#O...O...#...##..O#.#.##..OO..O#..O...O.#...##.......#...OO.#OO.O..
..##OO#.............#...O..OO.#...##....O.O.....O.#O...O.O...O#.###....#....#....#.O..O...#....O#O#.
...O..#.......O.....O......O..O.#O#O.#......OOO..#...#..O....#..O#.#.O..O..#......OO..O..#.OO...O...
O#..........#OOOO.##..O.O#O.#.#...OO......##..#OO#.O.O#OOO.OO#.......#O.#...O#O.O..OO.....O...#O....
..#O#..O....#........#OO###...#.##.##.O....#..#..O....#O..#......O....#..O..#.....O.#......O##..#.#.
##.#..##.O.O.#.O.....O....O#.#...O..#..#....##O.#....O..OO.O.....#O.#O....O.......#.OO..O.OOO#OO#...
#.........#.#.#..OO.O.....O...#......O#O.O....#..O.#OO....O..O...#O...####O...O.....#..#....O.#.##..
#........O.O..OO.....O.....#O.O.....O....#....#...O.#.#.#.O...O#..#....#OO##.#..##O.OO...#O#.OO.#.O.
O........O.....O...O..#..#.O..............#..##.#.....O#O#.#...O#.O...O..O...#.#..O..O.OO.O....#....
..O.O.........##.#O..O...O.O....O#.#..O..##.........#.#O.O.....#.#......OO#..OO.#.O.OO...O.OO..#.O.O
#OO...O##..O#..OO.O#O.#.#.O..#..O....O.O#.#O.#........OO.O..........#....O.O....#.OO.#O..........#O.
.O..O##.#.O.##.O..O......#...###...#..#OOO.#...#O.......O.....O.#.....O.OO#...O#O.O...#OO.....O.#.#.
....#.#.O...O#OO..#..OOOO...O.............O..O..O#..O.#.O.....#.O......#OO.O#OOO........#..#..OO...#
.O...#....O..O##.OO.###.O..OO.O....#.O..##.OO#O.....##..........###.O...O#..OO..O.O#O.....O.#.......
#.O......OOO......O.#..O..##...#O.O#.O#..OO..#..#O.OOO#..#.O.O...O..O....#O...O...#..#.##.O...#.O#.#
...O...O....O.#.#OOO.....O#O......O#..OO........O.....O..O.......##O..#...OOOOO#....O..#.O......#..O
#.....#....O.....O..O.O.#O#O.O.#.....#..#O.....#.#.#...OO.OOO#O##.##O.O.###.O..O...O#.#.O......##..O
.O.#..#.O##..#..OO#.#.O#.#.O..O.....#....O##...O.....##O..##...O...O...O.#.#...#O..OO...O....#....#.
O#..#.###....O.#..#.O.O...O.O....#.......#.O.#O.#...#.O.O#..#.#..O..O.O#...O....O.O.O##...#.....OOO.
...#.#O.#......OO#.##..O..#.#.O.###O...O.#O.O..O..#.....O..#O.O.O....OO##O..OO...O##.#....O.O...O...
.OO.O#..#.OO.O.O..O#OOO.OO.##.O........O..#.O..#..O.............O.O..#.OOO.#................##O.....
....##O...O..O..O.........#..O..O...O...O..O.#.....O......O#.O#.#.......OO...O.#.O#.....#.#........#
...#.O...OO.OOO.#O............O..O#..#...#..OO.....O........O..#.O..O...O#O....##O.O...O.O..#.O....#
...#.#O..O#.#..O....O..OO....O..O#O..........OO.O..O.......#.#..#....O..##.O.#....O#O.....#OO.....O.
..#.O...#.O..O#.....O...OO##.#.OO.O.O.O.O.#.O#...#O...O..###.....O#..#...........O.##O......#..O.#..
O.....O......O.O....#.O.O..#.#...O...#.O.O#OO..#...O#......O.OO.O.O..#...#.#.....O#....OOO..OOO.O..#
O....#O#....#..O#....##........O##O......O##.#O.....O.O.....#.##..#.OO..##....#.O#...OO........#..O.
.#....O...O.#......#O##.#......#..#.#...............OO.OOOOO.O.OO..OO.O.#.O.......#O....O#.#O..OO.O#
#O.OOO#OO....##.O.#.O#.O...#....#.....#....OO#.O.#OOOO....#..#.#.##.O...#...OOO...#......O......#.#.
O.#.#O.#.#.#.O.#.O........#.O.#.OO#O.O##.#..#...O.O.....O.#...O#.....#.OO..O#.OO.#...#.O....#.......
..O..O.O.O..###....#O...#O#.##O......#O....OO.O..O.#...O#.O....#..#.#.O.........#OO..........O#..O#.
#.#...........#.......#..OO..#.....##...#........#O.#O..#O....#OO.O.O....#.O..O#.....##.O###O##....O
..OO..OOOO.....O...#.O.#....O.....O.##O#...#..O...#...O.OOO.O..#.#...#....O#.#...#.O.O.O.....##..O.#
..OOO..#.#O..OO.O......O...#.#..O.....O.OO.O.O.OO...O..#.O.O.....#..O..#.##.O....#.#O.OOOOO#..O#.O..
.....#.....O......#..#.....O..........O####..O..O.#O#.....#O...#..O.#...#....#.OOOO.OO.O.O.O#...O..#
O.#.#O.#.O...O.OO..O......#...#.O#......O...##O#..O.OO.#....O#...OO...#...................O..#O...O.
.#.OO...OO....O#......O.O#O#O.O.O....O...O.OO#.#O.O.O.#O.O...#.....O..##.#..##..O#...O#O#...O...#...
.#.....#..##O.OOO#.O#.##.O..#..O#O..#..#...O#O.O##....O...O.O..O#..#.O.O.O.......#O..O..#O.O...O.#.O
......O..O.#..#.##.O.O....OO..O.....#.O..#O...#O.O..#..#..O...O..O..#.#O......O..O......O.....O.##..
..O....#O..O.#O...#O...#.O.#...O...#.#.#...O..O.#.......#...O...OO.#O..#OO..OO.O#OOO###.......#.O..O
..O..O...#..#....#....O..O#.#.O.........O.#.##.#O..#.OO.#O.O.O#.....#O..O....O#.........#.#.#.....O#
......O.#O#..#OO.#...O..#....#O.....#.......##.#.............O.#OO..#.O...#..O#.####.#OO..O.O...#.#.
#......O....O..O....O.....#.O......#.........#.O.O..#...#.O..O#...#.O#.#O.#..#.O....O.#...#O..O...#.
.O...#...OO.#O.....#...O#...O.O#.#.O.#O...OO..#.O##O#.#OO#O...O#......##.O.##O.#......O.........OO..
..O#.O..#OO..O........O.OO.O..O...O.#....#..#.#O#..O...#.....#.#OO.O.......#..O...OO..O.OO.#.#O.OO..
OO.O........O.#..O...O.O...OO#.O#O.O.O...OOO.O.#...O.......OO.#.#..O#.#..#..O...OO.#..O#O.#..#....O.
O..#..O.O#.OO..#...O#........#...#.O...O...#...#.#.O...#...#O.OO.#......O...O.O........#.##O#.O..#O.
OO.OO.#..#..#....O..O.O..O..........OO#.....##OO.O..##.......#.....O.......#...O....O..#........#O.O
O#.....O.O...#..#..O#..#.O.O##.O.#O...#O..O##O....O.O##.#...###...........O#.O...........O..O.O.....
....O......##....O.........#O...O#.#.#....O.#..........#.#.O..O..#..O...O....OOO......OO.O..O#..OO.O
.O.#..O........O.O.......O..##.#..OOO..#.#.....##.O.O.#.#...#.O.#.###.O.....O....O.....O..O.O.O#...#
...O..O.O#.....O.O.......O.O.#..#O#.O#..OOOO..#......O.O.#....O...#.#..#O....#..OOO.O.OO.#O.O....O#.
...O.....#....#OOO#.O#...#.O......#.#O.O...OO.O#.OO.OO..O...#........O#.#.O#.....O..O#.OOO........#.
O..O..O...O.............O..O.O.OO...O..O.....O...O#..##OO#O..#.##...#O..#O#......O##.O........#..#..
.OO.#.#O...O...O.#.O.O.O.........O..O..O..OOO....#..#.O#..O......#..#O..#....#..#.......OO.......O#.
#.....#.O#.....#..O..O.O..O...O.##O.O..#..O.......O.O..O........#....O.#...#OO.O..O...O..O.#..O..O.O
#..##.#O##.##..#.......##.O..OO.#.#O#O#...#.#.O....OOO.##OOO.OO.O#.O#........#...#...#.##.OOO..#..#.
....O.##O#O..#O..O.O#....OO....O...#.O..O.O..#O..O..#..OOO.....##OO.....#.O.#OO...#.O.OOO.O....#....
.O........#O...O.O.O.O#..O#.O.....#OO.#.O..#.#.O.....O....O......O....O..O.#..##.....O.#.....O..O...
O...O......#..O#.......#O.....O#.#.....#.O.OO.O.#O..O##.....OO#..O.O.O........#O..O.....#..........O
..#O.O.#.O.#..#......O#..O#..O..#...O..#.O.O#.##..#.#O..O..#.#...##.#...#..O#......#...O#O.O.#..#...
.OO...O..O...O.O..O..O#.....O.#O#.O#O.#.....O.#...#..#...O..OO.....O..O.O....#...#O#.#.OO#....O....O
.#...O.........#.O.O#.OO.#O..O....O.....O....##.....O..#OOO.....#...#.#OO..#O.O.O...#O.OO.O.#.......
..OO.#O......O.O..##.#........OO..O#..O...O..#..#...#O..##O...O#...##.#..O..#......#..O.O#.O.#...O.O
..##.O..###..OO.O#O..#.......O#...#.O#..OO.##O.O.O........#O#.#.OO....#.##.O.OO#.....O.O##........#.
..O.OO.O##.O...##O...#O..#O.#.O...#O.##..#.O.#..##....##.O....O....O.....###.....#O..#..O..#O...O...
.##.....#.....O#.O...#.....#.##.OO..OOO...OO#..O......#........#O.O..O.O...#...OO....O.#...O.O...O..
...O.....O.#....O...#..O.O......#..#OO.#.O.O#.#O....#.##...O...##O.O.O#.........O.#O......#O.......O
..###O..#O.#.O.....O.#........O.#........#O##.#..O#.##.O.O........O###.#.O....O.....###....O##O.....
#O#.....#.....O..............O...#..O..#O.O...........###.O.#.....##O.....O#O..#.....O.OO....O#O....
.#...O...O..#.#...............O.O#....O..#.#OO.O..O........O....O..O......##..#.#OO#...O#..O##......
.OO.O...O##O.#O#..O.......O..##.#O#.....#..O..O#.#O#.#...#...#..O..##..#....O.....#.#..O....O.##.O#.
#...O#.#O.O...#.O....O#.O#..O..O......OO#.O....#.....OO#O....#O.OOO...#OO..#..#O...#.#O..OO.#...O...
.O...O..O.O....#....#O...#.....#...O...#..OOO.....OO#OOO.O..#O.#....#..O...#...O..O.O##...#O.O.OO..#
O#O..O#......#.#O..#O....OO#O#...#...O....##...#.O...O.#O...OO....O.#.O.O...O#........#O.O..O#..#..O
OOO#....O...##.O.........OO..O.OOOOO.O..O..#..###.O.#....##.....O.O.O#.#..OOO....OO.....OO....O...#.
#O###O...O...#..OO...#O.....#.....O.O...O.#..OO#..##....O..##..O##.......O..O.O#OOO...O..#.....##...
..#O.....#.O#O#.O.#.#....#O..#O.O.O..#..O#..O.O.O...OO..#.#..##..O.O...OO..O.##.O.OO.#.#..##.......#
O...OO.O......#..#...O.#.O.#O...#.O.OO#...O....#OOO..#..O..O.....O.....#.O.#O#...OO.O#.OO..O.##...#.
.....#OO....O.O#O......O.O.O.#.O..O#O#...#O...#.#O...#.O..#.OO.O....OO...O#........#O...#.#........O
.O....#..OOO........#.O.#O.#.........#.#....O#OO#.......O..O#O.###.O....O.O.O......O.#.O..O..#...O.O
#.O.#O..##.OO...O##O......O#.OO........OO...O#....#....#..O#........O#..O.O...O.#O...#...#.#.....O##
.O.O.O.OO..OO.#..#....O....O.O#...O...OOO..#.OO#.....##........O...O#O.#..OO##.O.#..#..#O#.O..OO##..`


let inputLines = input.split('\n');
let input2DArray = inputLines.map(e => e.split(''));
let input2DArrayFlipped = flipLinesInitial(input2DArray);

// console.log(input2DArrayFlipped);

// let inputVert = input2DArrayFlipped.map(e => e.join('')).join('\n')

// let inputVert = rotate90(input2DArray);

// input2DArray = inputVert;

// console.log(inputVertText);


const rockRegex = /O/g;

let dic = {};


// console.log(input2DArray);


// TODO calculate needed cyles = let x = 1000000000 % [breakpoint-number]
let cycles = 1000;

let x = [];

let gdsfg = input2DArray.map(e => e.join('')).join('\n');
pushList(gdsfg);

for (let t = 0; t < 142; t++) {

    input2DArray = rotate90(input2DArray);
    input2DArray = replaceLeft(input2DArray);

    input2DArray = rotate90Back(input2DArray);
    input2DArray = replaceLeft(input2DArray);

    input2DArray = rotate90(input2DArray);
    input2DArray = replaceRight(input2DArray);

    input2DArray = rotate90Back(input2DArray);
    input2DArray = replaceRight(input2DArray);

    let y = countRocks(input2DArray);
    x.push(y)


    let inputText = input2DArray.map(e => e.join('')).join('\n');
    if (checkList(inputText))
    {
        console.log(true);
        console.log(t);
        break;
    }
    pushList(inputText);




    // console.log((t + 1) / cycles * 100);
    console.log(t)
}

// console.log(input2DArray.map(e => e.join('')).join('\n'));


let sum = countRocks(input2DArray);
console.log("SUM:")
console.log(sum);
console.log(x);



function checkList(inputText) {
    if (inputText in dic) {
        return true;
    }

    return false;
}

function pushList(inputText) {
    dic[inputText] = 1;
}



function replaceLeft(input2DArray) {
    let inputText = input2DArray.map(e => e.join('')).join('\n');
    let regexLeft = /\.O/;
    let regexRight = /O\./;

    while (inputText.match(regexLeft)) {
        inputText = inputText.replaceAll('\.O', 'O\.');
        // console.log(inputText)
    }

    return inputText.split('\n').map(e => e.split(''));
}

function replaceRight(input2DArray) {
    let inputText = input2DArray.map(e => e.join('')).join('\n');
    let regexLeft = /\.O/;
    let regexRight = /O\./;

    while (inputText.match(regexRight)) {
        inputText = inputText.replaceAll('O\.', '\.O');
        // console.log(inputText)
    }

    return inputText.split('\n').map(e => e.split(''));
}



// let arr = [[0,1,2], [3,4,5]];

// console.log(arr);

// let arrFlipped = rotate90(arr);
// let b = rotate90Back(arrFlipped)

// console.log(arrFlipped);
// console.log(b);


function rotate90(patternArray) {

    let newArray = [];
    for (let index = 0; index < patternArray[0].length; index++) {
        newArray.push([]);
    }

    for (let index = 0; index < patternArray.length; index++) {
        const line = patternArray[index];

        for (let j = line.length - 1; j >= 0; j--) {
            const char = line[j];

            newArray[j].push(char);
            
        }
        
    }

    return newArray;
}


function rotate90Back(patternArray) {
    let newArray = [];
    for (let index = 0; index < patternArray[0].length; index++) {
        newArray.push([]);
    }

    for (let index = 0; index < patternArray.length; index++) {
        const line = patternArray[index];

        for (let j = line.length - 1; j >= 0; j--) {
            const char = line[j];

            newArray[j].push(char);
            
        }
        
    }

    return newArray;
}





// for (let index = 0; index < input2DArray.length; index++) {
//     const line = input2DArray[index];

//     for (let j = 0; j < line.length; j++) {
//         const char = line[j];

//         if (char == 'O') {
//             // Move
//             moveRocksNorth(input2DArray, index, j);
//         }
//     }
// }



// for (let index = 0; index < input2DArray.length; index++) {
//     const line = input2DArray[index];

//     for (let j = 0; j < line.length; j++) {
//         const char = line[j];

//         if (char == 'O') {
//             // Move
//             moveRocksNorth(input2DArray, index, j);
//         }
//     }
// }



function moveRocksNorth(input2DArray, index, column) {
    if (index > 0 && input2DArray[index - 1][column] == '.') {

        for (let rowIndex = index - 1; rowIndex >= 0; rowIndex--) {
            if (input2DArray[rowIndex][column] == '.') {
                input2DArray[rowIndex][column] = 'O';
                input2DArray[rowIndex + 1][column] = '.';
            }
            else {
                break;
            }
        }
    }
}

function moveRocksSouth(input2DArray, index, column) {
    // console.log(input2DArray);
    // console.log(index);
    // console.log(column)


    if (index < input2DArray.length - 1 && input2DArray[index + 1][column] == '.') {

        for (let rowIndex = index + 1; rowIndex < input2DArray.length ; rowIndex++) {
            if (input2DArray[rowIndex][column] == '.') {
                input2DArray[rowIndex][column] = 'O';
                input2DArray[rowIndex - 1][column] = '.';
            }
            else {
                break;
            }
        }
    }
}

function moveRocksEast(input2DArray, index, column) {
    if (column < input2DArray[0].length - 1 && input2DArray[index][column + 1] == '.') {

        for (let columnIndex = column + 1; columnIndex < input2DArray[0].length ; columnIndex++) {
            if (input2DArray[index][columnIndex] == '.') {
                input2DArray[index][columnIndex] = 'O';
                input2DArray[index][columnIndex - 1] = '.';
            }
            else {
                break;
            }
        }
    }
}


function moveRocksWest(input2DArray, index, column) {
    if (column > 0 && input2DArray[index][column - 1] == '.') {

        for (let columnIndex = column - 1; columnIndex >= 0; columnIndex--) {
            if (input2DArray[index][columnIndex] == '.') {
                input2DArray[index][columnIndex] = 'O';
                input2DArray[index][columnIndex + 1] = '.';
            }
            else {
                break;
            }
        }
    }
}




function flipLinesInitial(patternArray) {

    let newArray = [];
    for (let index = 0; index < patternArray[0].length; index++) {
        newArray.push([]);
    }

    for (let index = 0; index < patternArray.length; index++) {
        const line = patternArray[index];

        for (let j = 0; j < line.length; j++) {
            const char = line[j];

            newArray[j].push(char);
            
        }
        
    }

    return newArray;
}



function updateFlipLines(patternArray, patternArrayVert) {


    for (let index = 0; index < patternArray.length; index++) {
        const line = patternArray[index];

        for (let j = 0; j < line.length; j++) {
            const char = line[j];

            patternArrayVert[j][index] = char;
            
        }
        
    }

    // console.log(newArray);


    return newArray;
}






// console.log(input2DArray);

function countRocks(input2DArray) {
    let rowCounter = 1;

    let sum = 0;


    for (let index = input2DArray.length - 1; index >= 0; index--) {
        const line = input2DArray[index];

        for (let j = 0; j < line.length; j++) {
            const char = line[j];

            if (char == 'O') {
                sum += rowCounter;
            }

            
        }



        rowCounter++;
        
    }

    return sum;

}


















// let rocks = [];

// for (let index = 0; index < inputLines.length; index++) {
//     const line = inputLines[index];

//     let rocksArray = [...line.matchAll(rockRegex)];

//     for (let j = 0; j < rocksArray.length; j++) {
//         let rock = rocksArray[j];
        
//         rocks.push(createRock(index, rock.index))

//     }

//     console.log(rocks);
    
// }


console.log("END");



function createRock(row, column) {
    return { row: row, column: column };
}



